<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simple RESTful API</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <header>
        <h1>Simple RESTful API</h1>
    </header>
    <div class="container">
        <section class="api-interactions">
            <h2>Interact with the API</h2>

            <div class="card">
                <h3>Get All Users</h3>
                <button onclick="getUsers()">Fetch All Users</button>
                <pre id="allUsersResult" class="code-block"></pre>
            </div>

            <div class="card">
                <h3>Get User by ID</h3>
                <input type="number" id="getUserId" placeholder="Enter User ID (e.g., 1)">
                <button onclick="getUserById()">Get User</button>
                <pre id="userByIdResult" class="code-block"></pre>
            </div>

            <div class="card">
                <h3>Add New User</h3>
                <form id="addUserForm">
                    <input type="text" id="newName" placeholder="Name" required>
                    <input type="email" id="newEmail" placeholder="Email" required>
                    <button type="submit">Add User</button>
                </form>
            </div>

            <div class="card">
                <h3>Update User (by ID)</h3>
                <input type="number" id="updateUserId" placeholder="Enter User ID">
                <input type="text" id="updateName" placeholder="New Name (optional)">
                <input type="email" id="updateEmail" placeholder="New Email (optional)">
                <button onclick="updateUser()">Update User</button>
                <pre id="updateUserResult" class="code-block"></pre>
            </div>

            <div class="card">
                <h3>Delete User (by ID)</h3>
                <input type="number" id="deleteUserId" placeholder="Enter User ID">
                <button onclick="deleteUser()">Delete User</button>
                <pre id="deleteUserResult" class="code-block"></pre>
            </div>

        </section>
    </div>
    <script>
        const allUsersResult = document.getElementById('allUsersResult');
        const userByIdResult = document.getElementById('userByIdResult');
        const deleteUserResult = document.getElementById('deleteUserResult');
        const addUserForm = document.getElementById('addUserForm');
        const updateUserResult = document.getElementById('updateUserResult'); // New for update user

        async function getUsers() {
            try {
                const response = await fetch('/api/users');
                const users = await response.json();
                allUsersResult.textContent = JSON.stringify(users, null, 2);
            } catch (error) {
                console.error('Error fetching users:', error);
                allUsersResult.textContent = 'Error fetching users.';
            }
        }

        async function getUserById() {
            const userId = document.getElementById('getUserId').value;
            if (!userId) {
                userByIdResult.textContent = 'Please enter a user ID.';
                return;
            }
            try {
                const response = await fetch(`/api/users/${userId}`);
                const user = await response.json();
                userByIdResult.textContent = JSON.stringify(user, null, 2);
            } catch (error) {
                console.error('Error fetching user:', error);
                userByIdResult.textContent = 'Error fetching user.';
            }
        }

        async function deleteUser() {
            const userId = document.getElementById('deleteUserId').value;
            if (!userId) {
                deleteUserResult.textContent = 'Please enter a user ID.';
                return;
            }
            try {
                const response = await fetch(`/api/users/${userId}`, {
                    method: 'DELETE'
                });
                const result = await response.json();
                deleteUserResult.textContent = JSON.stringify(result, null, 2);
                if (response.ok) {
                    getUsers(); // Refresh the list of users
                }
            } catch (error) {
                console.error('Error deleting user:', error);
                deleteUserResult.textContent = 'Error deleting user.';
            }
        }

        async function updateUser() {
            const userId = document.getElementById('updateUserId').value;
            const name = document.getElementById('updateName').value;
            const email = document.getElementById('updateEmail').value;

            if (!userId) {
                updateUserResult.textContent = 'Please enter a user ID.';
                return;
            }

            const updateData = {};
            if (name) updateData.name = name;
            if (email) updateData.email = email;

            if (Object.keys(updateData).length === 0) {
                updateUserResult.textContent = 'Please enter a name or email to update.';
                return;
            }

            try {
                const response = await fetch(`/api/users/${userId}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(updateData)
                });
                const result = await response.json();
                if (response.ok) {
                    updateUserResult.textContent = `User updated: ${JSON.stringify(result, null, 2)}`;
                    getUsers(); // Refresh the list of users
                } else {
                    updateUserResult.textContent = `Error updating user: ${result.message}`;
                }
            } catch (error) {
                console.error('Error updating user:', error);
                updateUserResult.textContent = 'An error occurred while updating the user.';
            }
        }


        addUserForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const name = document.getElementById('newName').value;
            const email = document.getElementById('newEmail').value;
            try {
                const response = await fetch('/api/users', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ name, email })
                });
                const newUser = await response.json();
                if (response.ok) {
                    alert(`User added: ${JSON.stringify(newUser)}`);
                    addUserForm.reset();
                    getUsers(); // Refresh the list of users
                } else {
                    alert(`Error adding user: ${newUser.message}`);
                }
            } catch (error) {
                console.error('Error adding user:', error);
                alert('An error occurred while adding the user.');
            }
        });
    </script>
</body>
</html>